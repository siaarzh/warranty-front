<nz-modal [(nzVisible)]="isVisible" nzTitle="Вход" (nzOnCancel)="handleCancel()" (nzAfterOpen)="onAuthModalOpen()">
  <div>
    <nz-tabset [(nzSelectedIndex)]="selectedAuthModalTab">

      <!-- OTP VERIFICATION LOGIN FORM -->
      <nz-tab nzTitle="По телефону">
        <!--          <form nz-form class="login-form" [formGroup]="authOTPForm" (ngSubmit)="onSubmit()">-->
        <form nz-form class="otp-login-form" [formGroup]="authOTPForm">
          <nz-form-item>
            <div nz-row>
              <nz-form-label [nzSpan]="5" nzOffset="1">Моб. номер</nz-form-label>
              <nz-form-control [nzSpan]="17" nzErrorTip="Введите номер мобильного телефона">
                <nz-input-group nzPrefixIcon="mobile">
                  <input
                    #PhoneInput
                    nz-input
                    id="phone"
                    formControlName="phone"
                    type="tel"
                    placeholder="+7 (777) 111 7777"
                    [imask]="{mask: '+{7} (000) 000 0000'}"
                    [unmask]="true"
                  />
                </nz-input-group>
              </nz-form-control>
            </div>
          </nz-form-item>
          <nz-form-item>
            <div nz-row *ngIf="!OTPRequested">
              <nz-form-label [nzSpan]="5" nzOffset="1">СМС код</nz-form-label>
              <nz-form-control [nzSpan]="17">
                <div nz-row>
                  <div nz-col nzSpan="24">
                    <button
                      nz-button
                      (click)="getOTP()"
                      nzBlock
                      nzType="primary"
                      nzSize="large"
                      [disabled]="authOTPForm.get('phone').invalid"
                    >
                      Запросить СМС код
                    </button>
                  </div>
                </div>
              </nz-form-control>
            </div>
            <div nz-row *ngIf="OTPRequested">
              <nz-form-label [nzSpan]="5" nzOffset="1">СМС код</nz-form-label>
              <nz-form-control [nzSpan]="17">
                <div nz-row>
                  <div nz-col nzSpan="15" formArrayName="otp">
                    <nz-input-group>
                      <div #OTPInput nz-row nzType="flex" [nzGutter]="{ xs: 16, sm: 8 , md: 8, lg: 8, xl: 8, xxl: 8}"
                           nzJustify="start">
                        <div nz-col [nzSpan]="6" nzOffset="0" *ngFor="let OTPControl of OTPControls;  index as i">
                          <input
                            #OTPFormRow
                            nz-input
                            nzSize="large"
                            type="text"
                            formControlName="{{ i }}"
                            maxlength="1"
                            style="font-weight: bolder"
                            (keyup)="keyUpEvent($event, i)"
                          />
                        </div>
                      </div>
                    </nz-input-group>
                  </div>
                  <div nz-col [nzSpan]="8" nzOffset="1" *ngIf="OTPRequested">
                    <button
                      nz-button
                      nzSize="large"
                      nzBlock
                      nzType="primary"
                      (click)="getOTP()"
                      [disabled]="OTPTimerStarted"
                    >
                      <i nz-icon nzType="reload"></i>
                      {{ OTPTimerStarted ? "0:" + OTPTimeLeft.toString().padStart(2, '0') : "повтор"}}
                    </button>
                  </div>
                </div>
              </nz-form-control>
            </div>
          </nz-form-item>
          <nz-form-item *ngIf="OTPRequested">
            <div nz-row>
              <nz-form-control [nzXs]="{ span: 22, offset: 0 }" [nzSm]="{ span: 22, offset: 1 }">
                <div nz-row>
                  <div nz-col >
                    <button
                      nz-button
                      (click)="onSubmit()"
                      nzBlock
                      nzType="primary"
                      nzSize="large"
                      [disabled]="authOTPForm.invalid"
                    >
                      Войти
                    </button>
                  </div>
                </div>
              </nz-form-control>
            </div>
          </nz-form-item>
<!-- TODO: auth: move remember checkbox to footer -->
          <nz-form-item>
            <div nz-row>
              <nz-form-control [nzSpan]="16" nzOffset="6">
                <div nz-row nzType="flex" nzJustify="start">
                  <div nz-col nzSpan="12">
                    <label nz-checkbox formControlName="remember">
                      <span>Запомнить меня</span>
                    </label>
                  </div>
                </div>
              </nz-form-control>
            </div>
          </nz-form-item>
        </form>
      </nz-tab>
      <!-- OTP VERIFICATION LOGIN FORM -->

      <!-- EMAIL LOGIN FORM -->
      <nz-tab nzTitle="По почте">
        <form nz-form class="email-login-form" [formGroup]="authEmailForm">
          <nz-form-item>
            <nz-form-control nzErrorTip="Please input your username!">
              <nz-input-group nzPrefixIcon="user">
                <input type="text" nz-input formControlName="email" placeholder="Логин или номер тел."/>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-control nzErrorTip="Please input your Password!">
              <nz-input-group nzPrefixIcon="lock">
                <input type="password" nz-input formControlName="password" placeholder="Пароль"/>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </form>
      </nz-tab>
      <!-- EMAIL LOGIN FORM -->

      <!-- SOCIAL LOGIN FORM -->
      <nz-tab nzTitle="Соцсети">
        <div class="social-login">
          <nz-form-item>
            <button id="google-btn" nzBlock nz-button [nzSize]="'large'" nzType="default">
              <img src="../../../assets/google_logo.svg">Войти с помощью Google
            </button>
          </nz-form-item>
          <nz-form-item id="fb-form-button">
            <button id="fb-btn" nzBlock nz-button [nzSize]="'large'" nzType="default">
              <img src="../../../assets/fb_logo.svg">Войти с помощью Facebook
            </button>
          </nz-form-item>
        </div>
      </nz-tab>
      <!-- SOCIAL LOGIN FORM -->

    </nz-tabset>


    <!--      <nz-form-item>-->
    <!--        <nz-form-control>-->
    <!--          <label nz-checkbox formControlName="remember">-->
    <!--            <span>Remember me</span>-->
    <!--          </label>-->
    <!--          <a class="login-form-forgot" class="login-form-forgot">Forgot password</a>-->
    <!--          <button nz-button class="login-form-button" [nzType]="'primary'">Log in</button>-->
    <!--          Or-->
    <!--          <a>register now!</a>-->
    <!--        </nz-form-control>-->
    <!--      </nz-form-item>-->

  </div>
  <div *nzModalFooter>
    <span>Modal Footer: </span>
    <!--    <button nz-button nzType="default" (click)="handleCancel()">Cancel</button>-->
    <button nz-button nzType="default" (click)="onReset()">Reset</button>
    <button nz-button nzType="primary" (click)="handleOk()" [nzLoading]="isConfirmLoading">Custom Submit</button>
  </div>
</nz-modal>
